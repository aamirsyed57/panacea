<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <script
            src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"></script>
    <style>

        button {
            margin: 10px
        }

        input {
            margin: 10px
        }

        textarea {
            width: 100%
        }

        .container {
            padding: 10px;
            border: solid
        }

        .client {
            width: 50%;
            float: left;
        }

        .out {
            max-height: 300px;
            overflow: scroll;
        }

    </style>
</head>
<script>
    var stompClients = {};
    var clientData = {};
    $(function () {

    });

    function resetClientConnect(id) {
        console.log("Resetting Connect for Client " + id);
        delete stompClients[id];
        delete clientData[id];
        $('#cn' + id).prop("disabled", false);
        $('#sm'+id).html("Disconnected");
        $('#out'+id).html("");
    }

    function disconnect(id) {
        if (stompClients[id] !== undefined) {
            stompClients[id].disconnect();
            resetClientConnect(id);
        } else {
            alert("Client " + id + ": Already Disconnected");
        }
    }

    function connect(id) {
        if (stompClients[id] === undefined) {
            stompClients[id] = Stomp.over(new SockJS('/ws-game'));
            stompClients[id].connect({}, function (frame) {
                    $('#cn' + id).prop("disabled", true);
                    var roomId = $('#client' + id +' .roomId').val();
                    console.log(roomId);
                    stompClients[id].subscribe('/topic/room/' + roomId, function (message) {
                        clientDataUpdate(id,0,1);
                        console.log(message);
                        var gameMsg = JSON.parse(message.body);
                        $('#out' + id).append("<br>" + message.body);
                    });
                    clientData[id] = {send:0,received:0};
                    clientDataUpdate(id,0,0);
                },
                function (message) {
                    resetClientConnect(id);
                });
        } else {
            alert("Client " + id + ": Already Connected");
        }

    }

    function send(id) {
        if (stompClients[id] !== undefined) {
            var roomId = $('#client' + id +' .roomId').val();
            console.log(roomId);
            var message = $('#in' + id).val();
            console.log(stompClients[id]);
            stompClients[id].send("/app/game.send/"+roomId, {}, message);
            clientDataUpdate(id,1,0);
        } else {
            alert("Client " + id + ": Connection not set")
        }
    }

    function clientDataUpdate(id, sendIncr, receivedIncr) {
        if(sendIncr > 0) {
            clientData[id].send++;
        } else if (receivedIncr > 0) {
            clientData[id].received++;
        }
        $('#sm'+id).html("Sent: "+clientData[id].send+", Received: "+clientData[id].received);
    }

</script>
<body>
<h1>Socket Demo</h1>

<div>
    <div class="client" id="client1">
        <div class="container">
            <label>Client 1 Room:</label> <input class="roomId" type="text" value='room123'>
            <button id="cn1" onclick="connect(1);">Connect</button>&nbsp;&nbsp;&nbsp;&nbsp;<button id="dcn1"
                                                                                                   onclick="disconnect(1);">
            Disconnect
        </button>
            <br>
            <label for="in1">Message: </label><textarea id="in1">{"type": "move", "player": "Alice","roomId": "room123","move": "left"}</textarea>
            <br>
            <button id="bt1" value="send" onclick="send(1)">Send</button>
            <span id="sm1">Disconnected</span>
            <br>
            <div class="out" id="out1"></div>
        </div>
    </div>


    <div class="client" id="client2">
        <div class="container">
            <label>Client 2 Room:</label> <input class="roomId" type="text" value='room123'>
            <button id="cn2" onclick="connect(2);">Connect</button>&nbsp;&nbsp;&nbsp;&nbsp;<button id="dcn2"
                                                                                                   onclick="disconnect(2);">
            Disconnect
        </button>
            <br>
            <label for="in2">Message: </label><textarea id="in2">{"type": "move", "player": "Brad","roomId": "room123","move": "right"}</textarea>
            <br>
            <button id="bt2" value="send" onclick="send(2)">Send</button>
            <span id="sm2">Disconnected</span>
            <br>
            <div class="out" id="out2"></div>
        </div>
    </div>
    <br>

    <div class="client" id="client3">
        <div class="container">
            <label>Client 3 Room:</label> <input class="roomId" type="text" value='room123'>
            <button id="cn3" onclick="connect(3);">Connect</button>
            &nbsp;&nbsp;&nbsp;&nbsp;<button id="dcn3" onclick="disconnect(3);">Disconnect</button>
            <br>
            <label for="in3">Message: </label><textarea id="in3">{"type": "move", "player": "Ram","roomId": "room124","move": "left"}</textarea>
            <br>
            <button id="bt3" value="send" onclick="send(3)">Send</button>
            <span id="sm3">Disconnected</span>
            <br>
            <div class="out" id="out3"></div>
        </div>
    </div>


    <div class="client" id="client4">
        <div class="container">
            <label>Client 4 Room:</label> <input class="roomId" type="text" value='room123'>
            <button id="cn4" onclick="connect(4);">Connect</button>
            &nbsp;&nbsp;&nbsp;&nbsp;<button id="dcn4" onclick="disconnect(4);">Disconnect</button>
            <br>
            <label for="in4">Message: </label><textarea id="in4">{"type": "move", "player": "Shyam","roomId": "room124","move": "right"}</textarea>
            <br>
            <button id="bt4" value="send" onclick="send(4)">Send</button>
            <span id="sm4">Disconnected</span>
            <br>
            <div class="out" id="out4"></div>
        </div>
    </div>
    <br>
</div>


</body>
</html>